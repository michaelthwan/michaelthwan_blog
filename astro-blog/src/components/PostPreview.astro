---
import type { CollectionEntry } from 'astro:content';

interface Props {
    post: CollectionEntry<'posts'>;
    formatDate: (dateStr: string) => string;
}

const { post, formatDate } = Astro.props;
---

<article class="post-preview">
    <div class="post-meta">
        <span class="post-date">{formatDate(post.data.published)}</span>
        <div class="post-tags">
            {post.data.tags.map(tag => (
                <span class={`tag ${tag}`}>{tag.charAt(0).toUpperCase() + tag.slice(1)}</span>
            ))}
        </div>
    </div>
    <a href={`/posts/${post.slug}`} class="post-link">
        <div class="post-thumbnail">
            <div class="thumbnail-placeholder">
                {post.data.thumbnail ? (
                    <img src={post.data.thumbnail} alt={post.data.title} />
                ) : (
                    <svg viewBox="0 0 200 120" class="thumbnail-svg">
                        <rect x="40" y="30" width="120" height="60" fill="#f5f5f5" stroke="#ddd" stroke-width="2" rx="4"/>
                        <text x="100" y="65" text-anchor="middle" font-size="12" fill="#999">Article</text>
                    </svg>
                )}
            </div>
        </div>
        <div class="post-content">
            <h3 class="post-title">{post.data.title}</h3>
            <p class="post-authors">
                {post.data.authors.slice(0, 3).map((author, i) => (
                    <Fragment>
                        <span set:html={author.replace(' ', '&nbsp;')} />
                        {i < Math.min(post.data.authors.length, 3) - 1 && ', '}
                    </Fragment>
                ))}
                {post.data.authors.length > 3 && <em>, et&nbsp;al.</em>}
            </p>
            <p class="post-abstract">{post.data.abstract}</p>
        </div>
    </a>
</article>
