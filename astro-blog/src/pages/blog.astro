---
import { getCollection } from 'astro:content';
import Base from '../layouts/Base.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import PostPreview from '../components/PostPreview.astro';

// Get all posts sorted by date (newest first)
const allPosts = (await getCollection('posts')).sort((a, b) => {
  return new Date(b.data.published).getTime() - new Date(a.data.published).getTime();
});

// Split by category
const mlPosts = allPosts.filter(post => post.data.category === 'ml');
const devPosts = allPosts.filter(post => post.data.category === 'dev');
const businessPosts = allPosts.filter(post => post.data.category === 'business');

// Format date for display
function formatDate(dateStr: string): string {
  const date = new Date(dateStr);
  const options: Intl.DateTimeFormatOptions = { year: 'numeric', month: 'short', day: 'numeric' };
  return date.toLocaleDateString('en-US', options).replace(',', '.');
}

const columns = [
    { posts: mlPosts, className: 'ml-column', title: 'Machine Learning', desc: 'Paper explainers, architectures, and the math behind modern AI' },
    { posts: devPosts, className: 'dev-column', title: 'Development', desc: 'Tools, workflows, and practical engineering insights' },
    { posts: businessPosts, className: 'business-column', title: 'Business & Industry', desc: 'Compensation, industry trends, and career strategy through data' },
];
---

<Base title="Michael Wan Interactive Insights" isHomepage={true}>
    <Header />

    <!-- Two Column Layout -->
    <main class="index-columns l-page">
        {columns.map(col => (
            <section class={`index-column ${col.className}`}>
                <div class="column-header">
                    <h2>{col.title}</h2>
                    <p class="column-desc">{col.desc}</p>
                </div>
                <div class="posts-list">
                    {col.posts.map(post => (
                        <PostPreview post={post} formatDate={formatDate} />
                    ))}
                    {col.posts.length === 0 && (
                        <p class="empty-column">No articles yet</p>
                    )}
                </div>
            </section>
        ))}
    </main>

    <Footer />
</Base>
