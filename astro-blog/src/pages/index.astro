---
import { getCollection } from 'astro:content';
import Base from '../layouts/Base.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';

// Get all posts sorted by date (newest first)
const posts = (await getCollection('posts')).sort((a, b) => {
  return new Date(b.data.published).getTime() - new Date(a.data.published).getTime();
});

// Format date for display
function formatDate(dateStr: string): string {
  const date = new Date(dateStr);
  const options: Intl.DateTimeFormatOptions = { year: 'numeric', month: 'short', day: 'numeric' };
  return date.toLocaleDateString('en-US', options).replace(',', '.');
}
---

<Base title="Knowledge Blog â€” Latest articles about machine learning" isHomepage={true}>
    <Header />

    <!-- Posts List -->
    <main class="posts-list l-page">
        {posts.map(post => (
            <article class="post-preview">
                <div class="post-meta">
                    <span class="post-date">{formatDate(post.data.published)}</span>
                    <div class="post-tags">
                        {post.data.tags.map(tag => (
                            <span class={`tag ${tag}`}>{tag.charAt(0).toUpperCase() + tag.slice(1)}</span>
                        ))}
                    </div>
                </div>
                <a href={`/posts/${post.slug}`} class="post-link">
                    <div class="post-thumbnail">
                        <div class="thumbnail-placeholder">
                            {post.data.thumbnail ? (
                                <img src={post.data.thumbnail} alt={post.data.title} />
                            ) : (
                                <svg viewBox="0 0 200 120" class="thumbnail-svg">
                                    <rect x="40" y="30" width="120" height="60" fill="#f5f5f5" stroke="#ddd" stroke-width="2" rx="4"/>
                                    <text x="100" y="65" text-anchor="middle" font-size="12" fill="#999">Article</text>
                                </svg>
                            )}
                        </div>
                    </div>
                    <div class="post-content">
                        <h2 class="post-title">{post.data.title}</h2>
                        <p class="post-authors">
                            {post.data.authors.slice(0, 3).map((author, i) => (
                                <Fragment>
                                    <span set:html={author.replace(' ', '&nbsp;')} />
                                    {i < Math.min(post.data.authors.length, 3) - 1 && ', '}
                                </Fragment>
                            ))}
                            {post.data.authors.length > 3 && <em>, et&nbsp;al.</em>}
                        </p>
                        <p class="post-abstract">{post.data.abstract}</p>
                    </div>
                </a>
            </article>
        ))}
    </main>

    <Footer />
</Base>
